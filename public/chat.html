<!DOCTYPE html>
<html>
<head>
  <title>ChaltuCare Live Chat</title>
</head>
<body>
  <h2>Live Chat</h2>

  <div id="messages" style="border:1px solid #ccc; height:200px; overflow:auto;"></div>

  <input id="messageInput" placeholder="Type message..." />
  <button onclick="sendMessage()">Send</button>

  <br><br>

  <input type="file" id="fileInput" />
  <button onclick="sendFile()">Send File</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const roomId = 'test-room';

    socket.emit('join-room', roomId);

    const messagesDiv = document.getElementById('messages');

    function addMessage(content) {
      const div = document.createElement('div');
      div.innerHTML = content;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value;
      if (!message) return;

      addMessage(`<b>You:</b> ${message}`);
      socket.emit('chat-message', { roomId, message });
      input.value = '';
    }

    socket.on('chat-message', (message) => {
      addMessage(`<b>Other:</b> ${message}`);
    });

    async function sendFile() {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) return;

      const formData = new FormData();
      formData.append('file', fileInput.files[0]);

      const res = await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      const data = await res.json();

      const link = `<a href="${data.fileUrl}" target="_blank">${data.originalName}</a>`;
      addMessage(`<b>You sent:</b> ${link}`);

      socket.emit('chat-message', {
        roomId,
        message: link
      });

      fileInput.value = '';
    }
  </script>
</body>
</html>
